<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="824.42">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0019b7}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #a71e12}
span.s1 {color: #0019b7}
span.s2 {color: #000000}
span.s3 {color: #606060}
span.s4 {color: #326f17}
span.s5 {color: #a71e12}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><b>Pfsm</b></p>
<p class="p2"><br></p>
<p class="p3"><b>superclass: ListPatterns</b></p>
<p class="p2"><br></p>
<p class="p3">finite state machine: every state links to possible <b>next states (indices)</b>.</p>
<p class="p3">starting from one of the <b>entry states </b>one of these links is randomly</p>
<p class="p3">chosen used to get the next state. When an end state is reached, the stream ends.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>Pfsm(list,repeats)</b></p>
<p class="p2"><br></p>
<p class="p3"><b>list</b>:</p>
<p class="p3"><span class="Apple-tab-span">	</span>[</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span> [ entry states ],</p>
<p class="p3"><span class="Apple-tab-span">	</span> <span class="Apple-tab-span">	</span>item, [ next states ],</p>
<p class="p3"><span class="Apple-tab-span">	</span> <span class="Apple-tab-span">	</span>item, [ next states ],</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span> ...</p>
<p class="p3"><span class="Apple-tab-span">	</span> <span class="Apple-tab-span">	</span>end item (or nil), nil</p>
<p class="p3"><span class="Apple-tab-span">	</span> ]</p>
<p class="p2"><span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space"> </span>next states: nil<span class="Apple-converted-space">  </span>is terminal</p>
<p class="p2"><span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space"> </span></p>
<p class="p4">(</p>
<p class="p5"><span class="s1">SynthDef</span><span class="s2">(</span>"help-sinegrain"<span class="s2">,<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="Apple-tab-span">	</span>{ <span class="s1">arg</span> out=0, freq=440, sustain=0.05;</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">var</span> env;</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>env = <span class="s1">EnvGen</span>.kr(<span class="s1">Env</span>.perc(0.01, sustain, 0.2), doneAction:2);</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">Out</span>.ar(out, <span class="s1">SinOsc</span>.ar(freq, 0, env))</p>
<p class="p4"><span class="Apple-tab-span">	</span>}).store;</p>
<p class="p4">)</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<p class="p4">(</p>
<p class="p4">a = <span class="s1">Pfsm</span>([</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>#[0,1],</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>67, #[0, 0, 3],</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>72, #[2],</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>73, #[0, 2],</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s1">Pseq</span>([74, 75, 76, 77]), #[2, 3, 3],</p>
<p class="p7"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>nil, nil</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>], <span class="s1">inf</span>).asStream;</p>
<p class="p7">Routine<span class="s2">({</span></p>
<p class="p4"><span class="Apple-tab-span">	</span>loop({</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="s1">Synth</span>(<span class="s3">"help-sinegrain"</span>, [<span class="s4">\freq</span>, a.next.midicps]);</p>
<p class="p4"><span class="Apple-tab-span">	</span>0.1.wait;</p>
<p class="p4"><span class="Apple-tab-span">	</span>})</p>
<p class="p4">}).play;</p>
<p class="p4">)</p>
<p class="p6"><br></p>
<p class="p4">(</p>
<p class="p7">Pfsm<span class="s2">([</span></p>
<p class="p4">     #[5, 6, 7], <span class="s5">// entry states</span></p>
<p class="p4">     </p>
<p class="p8"><span class="s2">    </span>//e1 (== state 0)</p>
<p class="p4">    <span class="s1">Pbind</span>( <span class="s4">\dur</span>, <span class="s1">Pseq</span>([ 1/8, 3/8 ]), <span class="s4">\midinote</span>, <span class="s1">Pseq</span>([ 86, 75 ]) ),</p>
<p class="p8"><span class="s2">     </span>//#[1],  // as given in CMJ</p>
<p class="p8"><span class="s2">     </span>// my de-boredom-ated version..</p>
<p class="p4">     #[1, 1, 1, 1, 1, 1, 1, 8],</p>
<p class="p8"><span class="s2">    </span>//e2 (== state 1)</p>
<p class="p4">    <span class="s1">Pbind</span>( <span class="s4">\dur</span>, 1/2, <span class="s4">\midinote</span>, <span class="s1">Pseq</span>([ 69 ]) ),</p>
<p class="p4">     #[0, 1],</p>
<p class="p8"><span class="s2">    </span>//e3 (== state 2)</p>
<p class="p4">    <span class="s1">Pbind</span>( <span class="s4">\dur</span>, 1/3, <span class="s4">\midinote</span>, <span class="s1">Pseq</span>([ 55, 60, 66 ]) ),</p>
<p class="p4">     #[0, 1, 2, 2, 2, 2, 3, 3, 3, 3],</p>
<p class="p8"><span class="s2">    </span>//e4 (== state 3)</p>
<p class="p4">    <span class="s1">Pbind</span>( <span class="s4">\dur</span>, 1/4, <span class="s4">\midinote</span>, <span class="s1">Pseq</span>([ 81, 80, 77, 76 ]) ),</p>
<p class="p4">     #[1, 4, 4, 4, 4],</p>
<p class="p8"><span class="s2">    </span>//e5 (== state 4)</p>
<p class="p4">    <span class="s1">Pbind</span>( <span class="s4">\dur</span>, <span class="s1">Pseq</span>([1, 2/3, 2/3, 2/3, 1]), <span class="s4">\midinote</span>, <span class="s1">Pseq</span>([ \, 70, 70, 70, \ ]) ),</p>
<p class="p4">     #[2, 3],</p>
<p class="p8"><span class="s2">    </span>//e6 (== state 5)</p>
<p class="p4">    <span class="s1">Pbind</span>( <span class="s4">\dur</span>, 1/4, <span class="s4">\midinote</span>, <span class="s1">Pseq</span>([ 59, 61 ]) ),</p>
<p class="p4">     #[0, 2, 4, 5, 5, 5, 5, 5, 5, 5],</p>
<p class="p8"><span class="s2">    </span>//e7 (== state 6)</p>
<p class="p4">    <span class="s1">Pbind</span>( <span class="s4">\dur</span>, 1/4, <span class="s4">\midinote</span>, <span class="s1">Pseq</span>([ 87, 88 ], 2) ),</p>
<p class="p4">     #[4, 4, 4, 4, 6, 6, 6, 7, 7, 7],</p>
<p class="p8"><span class="s2">    </span>//e8 (== state 7)</p>
<p class="p4">    <span class="s1">Pbind</span>( <span class="s4">\dur</span>, 1, <span class="s4">\midinote</span>, <span class="s1">Pseq</span>([ 56 ]) ),</p>
<p class="p4">     #[1, 3, 6, 6, 6],</p>
<p class="p8"><span class="s2">    </span>// terminal state</p>
<p class="p4">    <span class="s1">nil</span>, <span class="s1">nil</span></p>
<p class="p4">   ]).play;</p>
<p class="p4">)</p>
</body>
</html>
