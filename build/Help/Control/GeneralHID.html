<html>
<head>
</head>
<body>
<h1>GeneralHID</h1>

<p>GeneralHID is a cross platform wrapper for accessing HID devices. Currently the MacOSX and Linux HID support has been wrapped. Some of the code is inspired by the GUI wrapper.</p>

<p>Get the current scheme:<br>
GeneralHID.scheme<br>
GeneralHID.scheme.id
</p>

<p>Build a device list:<br>
GeneralHID.buildDeviceList;
</p>
<p>Get the device list:<br>
d = GeneralHID.deviceList;
</p>

<p>this works also:<br>
d = GeneralHID.buildDeviceList;
</p>

<p>Post the devices found:<br>
GeneralHID.postDevices;
</p>

<p>Post the devices and their capabilities:<br>
GeneralHID.postDevicesAndProperties;
</p>

<p>Start the event loop with rate (default is 0.005):<br>
GeneralHID.startEventLoop( 0.002 );
</p>
<p>Stop the event loop:<br>
GeneralHID.stopEventLoop;
</p>
<p>Check status of eventloop:<br>
GeneralHID.eventLoopIsRunning;
</p>
<p>(NOTE: the eventloop only needs to be started for MacOSX, nevertheless, in code that needs to function cross platform, include the eventloop commands: they will do no harm on Linux).
</p>

<p>Open a device:<br>
a = GeneralHID.open( d[5] );
</p>

<p>You need to take a device that shows up in the DeviceTable. You can do any kind of automatic detection to always get the device you want (e.g. on vendor and product id's)</p>

<p>Get the device info:<br>
a.info;
</p>

<p>Check whether device is open:<br>
a.isOpen;
</p>

<p>A dictionary with all slots:<br>
a.slots;
</p>
<p>The devices capabilities in a more readable form:<br>
a.caps;
</p>
<p>(on MacOSX not all elements may be detected as usable input; this is to be fixed)
</p>
<p>See if data is coming in:<br>
a.debug_( true );
</p>
<p>Turn it off again:<br>
a.debug_( false );
</p>
<p>Debugging can be turned on for each slot individually, if necessary:<br>
(IBM trackpoint)<br>
a.slots[1].at( 272 ).debug_( true );<br>
<br>
(external mouse on macbook pro)<br>
a.slots[3][1].debug_(true);<br>
<br>
(external mouse on ibm thinkpad)<br>
a.slots[2][1].debug_(true);<br>
</p>

<p>Turn it off again:<br>

(IBM trackpoint)<br>
a.slots[1].at( 272 ).debug_( false );<br>
<br>
(external mouse on macbook pro)<br>
a.slots[3][48].debug_(false);<br>
<br>
(external mouse on ibm thinkpad)<br>
a.slots[3][1].debug_(false);
</p>

<p>The current value of a slot can be checked:<br>

a.slots[1].at( 272 ).value;<br>
a.slots[2].at( 1 ).value;<br>
a.slots[3][1].value<br>
</p>

<p>
If the slot is an LED, you can set the value:
<pre>
a.slots[11][0].value = 1;
a.slots[11][0].value = 0;
</pre></p>

<p>Actions can be mapped to each slot individually.<br>

a.slots[1].at( 272 ).action_( { "hello".postln; } );<br>
a.slots[1].at( 273 ).action_( { "hi".postln; } );<br>

a.slots[3].at( 1 ).action_( { "hi".postln; } );
</p>
<p>with an input to the function<br>
a.slots[3].at( 1 ).action_( { |v| "hi, my value is ".post; v.value.postln; } );<br>

a.slots[1].at( 272 ).action_( { |v| "hi, my value is ".post; v.value.postln; } );
</p>

<p>To stop the action, assign it to an empty function.<br>

a.slots[1].at( 272 ).action_( {} );<br>
a.slots[1].at( 273 ).action_( {} );<br>

a.slots[3].at( 1 ).action_( {} );
</p>

<p>If the server is running you can create a control bus for the HID data to go to, so that a synth can immediately read the data:<br>

s = Server.local.boot;
</p>
<p>To create the bus:
<pre>
a.slots[1].at( 272 ).createBus( s );
a.slots[2].at( 8 ).createBus( s );
</pre>
</p>

<p><pre>(
SynthDef( \hidbus_help, { |out=0,amp=0|
	Out.ar( out, SinOsc.ar( 300, 0, 0.01*amp.abs ) );
}).load( s );
)
</pre>
</p>

<p>
<pre>x = Synth.new( \hidbus_help );
x.map( \amp, a.slots[2].at( 8 ).bus );
x.free;
</pre></p>
<p><pre>
( // a nicer version:
SynthDef( \hidbus_help, { |out=0,amp=0,amp2=0|
	Out.ar( out, SinOsc.ar( 300, 0, 0.01*amp.abs.lag( 0.1 ) * amp2.lag(0.01,0.99) ) );
}).load( s );
)
</pre></p>
<p>
<pre>x = Synth.new( \hidbus_help );
x.map( \amp, a.slots[2].at( 8 ).bus );
x.map( \amp2, a.slots[1].at( 272 ).bus );
x.free;
</pre>
</p><p>
<pre>( // a nicer version:
SynthDef( \hidbus_help, { |out=0,freqadd=0,amp=0|
	Out.ar( out, SinOsc.ar( 300 + (freqadd.lag(0.2,1)*40), 0, 0.2*amp.lag(0.01,0.99) ) );
}).load( s );
)
</pre>
</p>
<p>
x = Synth.new( \hidbus_help );<br>
x.map( \freqadd, a.slots[2].at( 8 ).bus );<br>
x.map( \amp, a.slots[1].at( 272 ).bus );<br>
x.free;<br>
</p>
<p>
To free the bus:<br>
a.slots[1].at( 272 ).freeBus;<br>
a.slots[2].at( 8 ).freeBus;
</p>
<p>
close the device:<br>
a.close;
</p>
<p>
<h2>TODO list</h2>
<ul>
<li>Get deviceSpecs working</li>
<li>Fix identical numbers between Linux and Mac (this may mean that the slot structure will change!)</li>
</ul>
</p>
</body>