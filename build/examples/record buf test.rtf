{\rtf1\mac\ansicpg10000\cocoartf102
{\fonttbl\f0\fnil\fcharset77 Monaco;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red191\green0\blue0;\red0\green0\blue191;
\red96\green96\blue96;\red191\green0\blue0;}
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f0\fs18 \cf2 \
s.boot; \cf3 // start the server\
\cf2 \
(\
\cf4 SynthDef\cf2 (\cf5 "bubbles"\cf2 , \{ \cf4 arg\cf2  bus=0;\
	\cf4 var\cf2  f, zout;\
	f = \cf4 LFSaw\cf2 .kr(0.4, 0, 24, \cf4 LFSaw\cf2 .kr([8,7.23], 0, 3, 80)).midicps; \cf3 // glissando function\
\cf2 	zout = \cf4 CombN\cf2 .ar(\cf4 SinOsc\cf2 .ar(f, 0, 0.04), 0.2, 0.2, 4); \cf3 // echoing sine wave\
\cf2 	\cf4 Out\cf2 .ar(bus, zout.postln);\
\}).writeDefFile;\
s.sendSynthDef(\cf5 "bubbles"\cf2 );\
)\
\
(\
\cf4 SynthDef\cf2 (\cf5 "Record"\cf2 , \{\
	\cf4 arg\cf2  bus = 0, buffer = 0;\
	\cf4 var\cf2  in, record;\
	in = \cf4 In\cf2 .ar(bus, 2);\
	\cf4 RecordBuf\cf2 .ar(in, buffer);\
\}).writeDefFile;\
s.sendSynthDef(\cf5 "Record"\cf2 );\
)\
\
s.sendMsg(\cf5 "/b_alloc"\cf2 , 0, 44100, 2);\
\
\cf3 // start something to record\
\cf2 s.sendMsg(\cf5 "/s_new"\cf2 , \cf5 "bubbles"\cf2 , 2003, 1, 0);\
\
\cf3 // start buffer recorder (will loop continuously)\
\cf2 s.sendMsg(\cf5 "/s_new"\cf2 , \cf5 "Record"\cf2 , 2004, 3, 2003);\
\
s.sendMsg(\cf5 "/s_trace"\cf2 , 2003);\
s.sendMsg(\cf5 "/s_trace"\cf2 , 2004);\
\
s.sendMsg(\cf5 "/b_write"\cf2 , 0, \cf5 "/tmp/snapshot_001.aiff"\cf2 , \cf5 "aiff"\cf2 , \cf5 "int16"\cf2 );\
\
s.sendMsg(\cf5 "/b_write"\cf2 , 0, \cf5 "/tmp/snapshot_002.aiff"\cf2 , \cf5 "aiff"\cf2 , \cf5 "int16"\cf2 );\
\
s.sendMsg(\cf5 "/b_write"\cf2 , 0, \cf5 "/tmp/snapshot_003.aiff"\cf2 , \cf5 "aiff"\cf2 , \cf5 "int16"\cf2 );\
\
s.sendMsg(\cf5 "/n_free"\cf2 , 2003);\
\
s.sendMsg(\cf5 "/n_free"\cf2 , 2004);\
\
\cf6 ////////////////////////////////////////////////////////////////////////\cf3 \
\cf2 \
\cf3 // you can test the files in QuickTime or play them below.\
\cf2 \
\cf6 ////////////////////////////////////////////////////////////////////////\cf3 \
\cf2 \
(\
\cf4 SynthDef\cf2 (\cf5 "Play"\cf2 , \{\
	\cf4 arg\cf2  bus = 0, buffer = 0;\
	\cf4 var\cf2  in, record;\
	in = \cf4 In\cf2 .ar(bus, 2);\
	\cf4 Out\cf2 .ar(0, \cf4 PlayBuf\cf2 .ar(2, buffer, 1, 1, 0, 1));\
\}).writeDefFile;\
s.sendSynthDef(\cf5 "Play"\cf2 );\
)\
\
s.sendMsg(\cf5 "/b_zero"\cf2 , 0);\
\
s.sendMsg(\cf5 "/s_new"\cf2 , \cf5 "Play"\cf2 , 2005, 1, 0);\
s.sendMsg(\cf5 "/s_trace"\cf2 , 2005);\
s.sendMsg(\cf5 "/b_allocRead"\cf2 , 0, \cf5 "/tmp/snapshot_001.aiff"\cf2 );\
s.sendMsg(\cf5 "/b_zero"\cf2 , 0);\
\
s.sendMsg(\cf5 "/b_allocRead"\cf2 , 0, \cf5 "/tmp/snapshot_002.aiff"\cf2 );\
s.sendMsg(\cf5 "/b_zero"\cf2 , 0);\
\
s.sendMsg(\cf5 "/b_allocRead"\cf2 , 0, \cf5 "/tmp/snapshot_002.aiff"\cf2 );\
s.sendMsg(\cf5 "/b_zero"\cf2 , 0);\
\
s.sendMsg(\cf5 "/n_free"\cf2 , 2005);\
\
}