{\rtf1\mac\ansicpg10000\cocoartf102
{\fonttbl\f0\fswiss\fcharset77 Helvetica-Bold;\f1\fswiss\fcharset77 Helvetica;\f2\fnil\fcharset77 Monaco;
}
{\colortbl;\red255\green255\blue255;\red0\green0\blue191;\red0\green115\blue0;\red191\green0\blue0;
\red0\green0\blue0;\red0\green0\blue191;\red0\green115\blue0;\red191\green0\blue0;}
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f0\b\fs36 \cf0 BeatClockPlayer
\fs52 		
\fs26 tempo synched trigger
\f1\b0\fs18 \
\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\fs24 \cf0 superclass:  KrPlayer\
\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f0\b \cf0 	BeatClockPlayer.new(tempoFactor)\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f1\b0 \cf0 \
tempoFactor is in old-style music terms:\
	16 means a 16th note.\
	8 means an 8th note\
	1 is a whole note.\
	etc.\
\
The cpu-cheapest ways to get a steady tempo locked trig.\
If it starts precisely on a downbeat, it can be trusted to keep on the beat for a very long time.\
\
This object is shared.  Only one needs to be created on the server for every time division.  After that, subsequent requests for a BeatClockPlayer to play return a reference to the bus that the first one created is playing on.\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\fs18 \cf0 \
(\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f2 \cf2 	Instr\cf0 (\\beatClockPlayerTest,\{ \cf2 arg\cf0  gate=0.0;\
		\cf2 var\cf0  a,t;\
\
		t = gate;\
		a = \cf2 Decay2\cf0 .kr(t,0.01,0.1).clip2(1.0);\
		a * SinOsc.ar(300);\
	\},[\
		\cf3 \\gate\cf0 \
	]);\
	\
	p=\cf2 Patch\cf0 .new(\\beatClockPlayerTest,\
	[\
		\cf2 BeatClockPlayer\cf0 (16) \cf4 // trig / gate \
\cf0 	]);\
\
	p.play;\
)\
\
\cf2 Tempo\cf0 .bpm = 10;\
\cf2 Tempo\cf0 .bpm = 100;\
\
p.stop;\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f1 \cf0 \
\
\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\fs24 \cf0 BeatClockPlayer is actually just an Impulse ugen with its frequency driven by the tempo setting.  When used at the same time as a Stream2Trig, StreamKrDur or other client-side scheduling driven device, it is possible for inaccuracies in the accounting methods to build up to noticeable loss of sync.\
\
Even clicking on different windows is leading to disturbances.  This is TempoClock's inaccuracy, it is lagging.\
\
Try changing the tempo or dragging windows.\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\fs18 \cf0 (
\f2 \cf5 \
	\cf6 Instr\cf5 (\cf7 \\beatClockPlayerTest\cf5 ,\{ \cf6 arg\cf5  gate=0.0,freq=300;\
		\cf6 var\cf5  a,t;\
\
		t = gate;\
		a = \cf6 Decay2\cf5 .kr(t,0.01,0.1).clip2(1.0);\
		a * \cf6 SinOsc\cf5 .ar(freq);\
	\},[\
		\cf7 \\gate\cf5 \
	]);\
	\
	\cf6 PlayerMixer\cf5 ([\
		\cf6 Patch\cf5 .new(\cf7 \\beatClockPlayerTest\cf5 ,\
		[\
			\cf6 BeatClockPlayer\cf5 (4), \cf8 // trig / gate \cf5 \
			300\
		]),\
		\cf6 Patch\cf5 .new(\cf7 \\beatClockPlayerTest\cf5 ,\
		[\
			\cf6 Stream2Trig\cf5 (\cf6 1.0\cf5 ,1.0),\
			600\
		])\
	]).play;\
\
	\cf6 Tempo\cf5 .default.gui\

\f1 \cf0 )\
\
\
\
\
\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f2 \cf4 /** \
\
( // funk 2001\
	Instr([\\shaperSynths1,\\decay2,\\one],\{ arg gate=0.0, freq=440,direction=0.2,\
				envadsr,attack=0.01,decay=0.2,ffreq=4000;\
		var p,a;\
	\
		a = Decay2.kr(Trig.kr(gate ,0.05),attack,decay,direction).clip2(1.0);\
		p = SinOsc.ar(freq,0,a);\
		\
		p=LPF.ar(p,ffreq);\
		p=Enveloper2.ar(p,gate,envadsr);\
		HPF.ar(p,200)\
						\
	\},[\
		[\\gate],\
		[\\freq],\
		[\\bipolar]\
	]);\
	\
	p=Patch.new([\\shaperSynths1,\\decay2,\\one],\
	[\
		BeatClockPlayer(16), // trig / gate \
		StreamKrDur( \
			Prand(Array.fill(rrand(7,32),\{ rrand(20,80).midicps \}),inf),\
			 0.25,// a float\
			 0.1),\
			-0.2,\
	  	Env.perc,\
	  	0.07,\
	  	0.7,\
	  	4000\
	  ]);\
	 	  \
	 p.topGui;\
)\
\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f1\fs24 \cf4 \
Being a subclass of KrPlayer, the natural rate of a BeatClockPlayer is .kr rate.\
If you .value a BeatClockPlayer you get a .kr rate signal.\
\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f2\fs18 \cf4 \
**/\cf0 \
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural

\f1\fs24 \cf0 \
}